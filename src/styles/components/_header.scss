@use '../generals/mixins' as *;
@use '../generals/custom-variables' as *;
@use '../generals/colors' as *;
@use '../generals/icons' as *;
@use '../generals/utility-classes' as *;
@use '../components/separator' as *;

/* Override parent theme clearfix for site-header to allow flexbox layout */
.site-header::before,
.site-header::after {
    content: none;
}
// --- Site Header Styles ---
.site-header {
    position: sticky;
    top: 0;
    left: 0;
    z-index: 999;
    background-color: var(--color-surface-page);
    .container {
        position: relative;
        width: 100%;
        height: max-content;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--size-200) var(--size-500);
        .logo {
            z-index: 1;
            transition: $transition;
        }
        .sub-menu {
            width: max-content;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--size-100);
        }
        .site-navigation {
            z-index: 0;
            position: absolute;
            top: var(--size-200);
            left: var(--size-500);
            right: var(--size-500);
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            background-color: var(--color-surface-content);
            border: 1px solid var(--color-border-primary);
            border-radius: 1rem;
            box-shadow: var(--box-shadow-dp3);
            overflow: hidden;
            // --- Animation: Initial State (Hidden) ---
            // Use transform and opacity for smooth, performant animations.
            opacity: 0;
            visibility: hidden;
            // transition: $transition; // GSAP will now handle the animation.

            .menu-container {
                width: 100%;
                height: max-content;
                display: flex;
                flex-direction: column;
                // align-items: center;
                gap: 1rem;
                padding: var(--size-300);
                
                .menu-header {
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    height: 80px; // tamaño logo scaled cuando .toggled activo
                    margin-left: 80px; // tamaño logo scaled cuando .toggled activo
                    padding: var(--size-100);
                    .availability-chip {
                        width: 100%;
                    }
                }
                ul.menu {
                    width: 100%;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    gap: .5rem;
                    margin: 0;
                    li {
                        width: 100%;
                    }
                    li:not(.menu-item-mail) {
                        display: flex;
                        align-items: center;
                        justify-content: flex-start;
                        margin: 0;
                        border-radius: .5rem;
                        overflow: hidden;
                        .icon-trailing {
                            margin-left: auto;
                            font-size: inherit !important;
                        }
                        a.btn {
                            width: 100%;
                            justify-content: flex-start;
                            color: var(--color-text-secondary);
                            i {
                            color: var(--color-text-tertiary);
                            }
                        }
                        // Specific styles for Blog menu item
                        &:is(.menu-item-blog) {}
                        &:hover {
                            background-color: var(--color-neutral-50);
                        }
                        // &:is(.menu-item-blog):hover {
                        //     background-color: var(--palette-accent-background);
                        // }
                        // Active and parent menu items
                        // These selectors target the active page and its parent items.
                        // For example:
                        // Home > ".current_page_item"
                        // Portfolio > ".current_page_parent"
                        // Blog > ".current_page_item"
                        &:is(.current_page_item, .current_page_parent) {
                            background-color: var(--color-component-background);
                            a {
                                color: var(--color-component-foreground);
                                i {
                                    color: var(--color-component-foreground);
                                }
                            }
                        }
                        &:is(.menu-item-blog):is(.current_page_item, .current_page_parent) {
                            background-color: var(--color-component-background);
                            a {
                                color: var(--color-component-foreground);
                                i {
                                    color: var(--color-component-foreground);
                                }
                            }
                        }
                    }
                }
                hr {
                    @include separator($margin-top:0, $margin-bottom:0);
                }
            }
        }
    }
    &.toggled {
        .container {
            .logo {
                transform: translate(var(--size-500), var(--size-500)) scale(1.4815);
            }
            .site-navigation {}
            &::after {
                display: none !important;
            }
        }
    }
}

// --- Menu Overlay ---
// This is a dedicated element, so it's not affected by the header's transforms.
#menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    // Apply a backdrop-filter for the blur effect.
    -webkit-backdrop-filter: blur(3px); // For Safari
    backdrop-filter: blur(3px);
    z-index: 998; // Position it just below the header (which is 999).

    // Animation for fade-in/out effect.
    opacity: 0;
    visibility: hidden;
    // transition: opacity 0.4s ease-out, visibility 0s 0.4s; // GSAP will now handle the animation.
}


@include media-up($breakpoint-sm) {
    .site-header {
        .container {
            .site-navigation {
                max-width: max-content;
                right: unset;
            }
        }
    }
}